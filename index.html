<!DOCTYPE html>
<html>
<head><meta charset="utf-8"></head>
<body style="background:#000">
    <!-- Cast bootstrapper: receives session info via CASTV2, redirects to server -->
    <script src="//www.gstatic.com/cast/sdk/libs/caf_receiver/v3/cast_receiver_framework.js"></script>
    <script>
    const ctx = cast.framework.CastReceiverContext.getInstance();
    const NS = 'urn:x-cast:com.phonemirror.session';

    ctx.addCustomMessageListener(NS, (event) => {
        const { hubUrl, deviceId, sourceId } = event.data;
        if (hubUrl && deviceId && sourceId) {
            // Redirect to server's own receiver page (same-origin HTTP, no mixed content)
            window.location.href = hubUrl + '/cast-receiver.html'
                + '?deviceId=' + encodeURIComponent(deviceId)
                + '&sourceId=' + encodeURIComponent(sourceId);
        }
    });

    ctx.start({
        disableIdleTimeout: true,
        customNamespaces: { [NS]: cast.framework.system.MessageType.JSON }
    });
    </script>
</body>
</html>
